# 非洲在线彩票博彩产品全面开发计划

## 项目概述

### 产品定位
- **目标市场**: 尼日利亚、喀麦隆等非洲英语区国家
- **产品类型**: 合规在线彩票和博彩综合平台
- **支持平台**: PC端 + 移动端(响应式设计)
- **核心货币**: 尼日利亚奈拉(NGN)，（暂时不支持虚拟货币）
- **核心特色**: 11选5彩票（核心） + "666"刮刮乐 + 大乐透 + 欧洲在线体育彩票 + 统一返水系统

### 技术架构选型

#### 前端技术栈
- **框架**: React 18 + TypeScript
- **状态管理**: Redux Toolkit + RTK Query
- **UI组件库**: Ant Design + 自定义组件
- **移动端适配**: 响应式设计 + PWA支持
- **样式方案**: Tailwind CSS + CSS Modules
- **构建工具**: Vite
- **多语言**: react-i18next (英语/法语)

#### 后端技术栈（Django大规模用户方案）
- **框架**: Python Django 4.2+ / Django REST Framework
- **异步处理**: Django Channels + Celery + Redis
- **数据库**: PostgreSQL (主库) + Redis (缓存/会话/队列)
- **数据库优化**: 读写分离 + 分库分表 + 连接池
- **认证**: Django Auth + JWT + 双因子认证
- **支付集成**: Paystack, Flutterwave, 移动货币API
- **消息队列**: Celery + Redis/RabbitMQ
- **文件存储**: Django-storages + AWS S3 / 阿里云OSS
- **缓存策略**: Redis + Memcached 多层缓存
- **搜索引擎**: Elasticsearch (用户搜索/数据分析)
- **API文档**: Django REST Swagger/OpenAPI
- **数据分析**: Django + Pandas + NumPy
- **性能监控**: Django-silk + APM工具

## Django支持大规模用户的技术优势

### 1. 架构优势
```python
# Django项目结构（支持10万+用户）
DJANGO_SETTINGS = {
    # 数据库配置 - 读写分离
    'DATABASES': {
        'default': {
            'ENGINE': 'django.db.backends.postgresql',
            'NAME': 'lottery_main',
            'HOST': 'master-db.example.com',
            'OPTIONS': {
                'MAX_CONNS': 100,
                'CONN_MAX_AGE': 600,
            }
        },
        'read_replica': {
            'ENGINE': 'django.db.backends.postgresql',
            'NAME': 'lottery_replica',
            'HOST': 'replica-db.example.com',
        }
    },
    
    # 缓存配置 - 多层缓存
    'CACHES': {
        'default': {
            'BACKEND': 'django_redis.cache.RedisCache',
            'LOCATION': 'redis://127.0.0.1:6379/1',
            'OPTIONS': {
                'CLIENT_CLASS': 'django_redis.client.DefaultClient',
                'CONNECTION_POOL_KWARGS': {'max_connections': 50},
            }
        },
        'sessions': {
            'BACKEND': 'django_redis.cache.RedisCache',
            'LOCATION': 'redis://127.0.0.1:6379/2',
        }
    },
    
    # 会话配置
    'SESSION_ENGINE': 'django.contrib.sessions.backends.cache',
    'SESSION_CACHE_ALIAS': 'sessions',
    
    # 异步任务配置
    'CELERY_BROKER_URL': 'redis://localhost:6379/3',
    'CELERY_RESULT_BACKEND': 'redis://localhost:6379/4',
}
```

### 2. 数据库优化策略
```python
# models.py - 优化的数据模型
from django.db import models
from django.contrib.auth.models import AbstractUser
from django.core.cache import cache

class User(AbstractUser):
    phone = models.CharField(max_length=20, unique=True, db_index=True)
    country = models.CharField(max_length=2, default='NG', db_index=True)
    vip_level = models.IntegerField(default=0, db_index=True)
    total_turnover = models.DecimalField(max_digits=15, decimal_places=2, default=0)
    referral_code = models.CharField(max_length=20, unique=True, db_index=True)
    referred_by = models.ForeignKey('self', null=True, blank=True, on_delete=models.SET_NULL)
    
    class Meta:
        indexes = [
            models.Index(fields=['phone', 'is_active']),
            models.Index(fields=['vip_level', 'total_turnover']),
            models.Index(fields=['referral_code']),
        ]

class UserBalance(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE, primary_key=True)
    main_balance = models.DecimalField(max_digits=15, decimal_places=2, default=0)
    bonus_balance = models.DecimalField(max_digits=15, decimal_places=2, default=0)
    frozen_balance = models.DecimalField(max_digits=15, decimal_places=2, default=0)
    updated_at = models.DateTimeField(auto_now=True)
    
    def get_total_balance(self):
        # 使用缓存优化频繁查询
        cache_key = f'user_balance_{self.user_id}'
        balance = cache.get(cache_key)
        if balance is None:
            balance = self.main_balance + self.bonus_balance
            cache.set(cache_key, balance, 300)  # 缓存5分钟
        return balance

# 分表策略 - 按月分表存储交易记录
class TransactionManager(models.Manager):
    def get_table_name(self, date):
        return f"transactions_{date.strftime('%Y_%m')}"
    
    def create_monthly_table(self, date):
        # 动态创建月度交易表
        pass

class Transaction(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE, db_index=True)
    type = models.CharField(max_length=20, db_index=True)
    amount = models.DecimalField(max_digits=15, decimal_places=2)
    status = models.CharField(max_length=20, default='PENDING', db_index=True)
    created_at = models.DateTimeField(auto_now_add=True, db_index=True)
    
    objects = TransactionManager()
    
    class Meta:
        indexes = [
            models.Index(fields=['user', 'created_at']),
            models.Index(fields=['type', 'status']),
        ]
```

### 3. 高性能API设计
```python
# views.py - 优化的API视图
from django.core.cache import cache
from django.db import transaction
from rest_framework.decorators import api_view
from rest_framework.response import Response
from celery import shared_task

class UserBalanceViewSet(viewsets.ModelViewSet):
    def get_balance(self, request):
        user_id = request.user.id
        
        # 使用缓存减少数据库查询
        cache_key = f'user_balance_{user_id}'
        balance_data = cache.get(cache_key)
        
        if balance_data is None:
            try:
                balance = UserBalance.objects.select_related('user').get(user_id=user_id)
                balance_data = {
                    'main_balance': float(balance.main_balance),
                    'bonus_balance': float(balance.bonus_balance),
                    'total_balance': float(balance.get_total_balance())
                }
                cache.set(cache_key, balance_data, 300)
            except UserBalance.DoesNotExist:
                balance_data = {'main_balance': 0, 'bonus_balance': 0, 'total_balance': 0}
        
        return Response(balance_data)

# 异步任务处理
@shared_task
def process_deposit(transaction_id):
    """异步处理存款"""
    try:
        with transaction.atomic():
            trans = Transaction.objects.select_for_update().get(id=transaction_id)
            if trans.status == 'PENDING':
                # 处理存款逻辑
                user_balance = UserBalance.objects.select_for_update().get(user=trans.user)
                user_balance.main_balance += trans.amount
                user_balance.save()
                
                trans.status = 'COMPLETED'
                trans.save()
                
                # 清除缓存
                cache.delete(f'user_balance_{trans.user.id}')
                
    except Exception as e:
        # 错误处理和日志记录
        logger.error(f"Deposit processing failed: {e}")

@shared_task
def calculate_daily_rewards():
    """每日返水计算 - 异步批量处理"""
    from datetime import date, timedelta
    
    yesterday = date.today() - timedelta(days=1)
    
    # 批量处理用户返水
    users = User.objects.filter(is_active=True).iterator(chunk_size=1000)
    
    for user in users:
        calculate_user_reward.delay(user.id, yesterday)

@shared_task
def calculate_user_reward(user_id, period_date):
    """计算单个用户的返水奖励"""
    # 具体的返水计算逻辑
    pass
```

### 4. 缓存优化策略
```python
# cache.py - 缓存策略
from django.core.cache import cache
from django.conf import settings
import hashlib

class CacheManager:
    @staticmethod
    def get_user_cache_key(user_id, data_type):
        return f'user_{user_id}_{data_type}'
    
    @staticmethod
    def get_game_cache_key(game_type, game_id):
        return f'game_{game_type}_{game_id}'
    
    @staticmethod
    def cache_user_data(user_id, data_type, data, timeout=300):
        """缓存用户数据"""
        cache_key = CacheManager.get_user_cache_key(user_id, data_type)
        cache.set(cache_key, data, timeout)
    
    @staticmethod
    def get_user_data(user_id, data_type):
        """获取缓存的用户数据"""
        cache_key = CacheManager.get_user_cache_key(user_id, data_type)
        return cache.get(cache_key)
    
    @staticmethod
    def invalidate_user_cache(user_id, data_types=None):
        """清除用户相关缓存"""
        if data_types is None:
            data_types = ['balance', 'vip_status', 'rewards']
        
        for data_type in data_types:
            cache_key = CacheManager.get_user_cache_key(user_id, data_type)
            cache.delete(cache_key)

# 装饰器 - 自动缓存API响应
def cache_api_response(timeout=300):
    def decorator(view_func):
        def wrapper(request, *args, **kwargs):
            # 生成缓存键
            cache_key = f"api_{request.path}_{hashlib.md5(str(request.GET).encode()).hexdigest()}"
            
            # 尝试从缓存获取
            cached_response = cache.get(cache_key)
            if cached_response:
                return cached_response
            
            # 执行视图函数
            response = view_func(request, *args, **kwargs)
            
            # 缓存响应
            if response.status_code == 200:
                cache.set(cache_key, response, timeout)
            
            return response
        return wrapper
    return decorator
```

### 5. 数据库连接池和查询优化
```python
# settings.py - 数据库连接池配置
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'lottery_db',
        'USER': 'lottery_user',
        'PASSWORD': 'password',
        'HOST': 'localhost',
        'PORT': '5432',
        'OPTIONS': {
            'MAX_CONNS': 100,  # 最大连接数
            'CONN_MAX_AGE': 600,  # 连接最大存活时间
        },
        'CONN_HEALTH_CHECKS': True,
    }
}

# 查询优化示例
class OptimizedQueryMixin:
    @staticmethod
    def get_user_with_balance(user_id):
        """优化的用户余额查询"""
        return User.objects.select_related('userbalance').get(id=user_id)
    
    @staticmethod
    def get_user_transactions(user_id, limit=50):
        """优化的交易记录查询"""
        return Transaction.objects.filter(user_id=user_id)\
                                 .select_related('user')\
                                 .order_by('-created_at')[:limit]
    
    @staticmethod
    def get_lottery_stats():
        """优化的彩票统计查询"""
        from django.db.models import Count, Sum
        
        return LotteryBet.objects.aggregate(
            total_bets=Count('id'),
            total_amount=Sum('amount'),
            total_winnings=Sum('actual_win')
        )
```

#### 基础设施
- **部署**: Docker + Kubernetes
- **CDN**: CloudFlare
- **监控**: Prometheus + Grafana
- **日志**: ELK Stack
- **安全**: SSL证书 + WAF防护

## 核心功能模块设计

### 1. 用户认证与安全模块

#### 1.1 注册登录系统
```typescript
// 用户注册接口
interface RegisterRequest {
  username: string;
  email: string;
  phone: string;
  password: string;
  country: 'NG' | 'CM'; // 尼日利亚/喀麦隆
  referralCode?: string;
}

// 登录接口
interface LoginRequest {
  identifier: string; // 用户名/邮箱/手机号
  password: string;
  captcha: string;
  deviceId: string;
}
```

#### 1.2 KYC身份验证
```typescript
interface KYCData {
  fullName: string;
  dateOfBirth: string;
  address: string;
  idType: 'NIN' | 'PASSPORT' | 'DRIVERS_LICENSE';
  idNumber: string;
  idFrontImage: string;
  idBackImage: string;
  selfieImage: string;
  status: 'PENDING' | 'APPROVED' | 'REJECTED';
}
```

### 2. 财务中心模块

#### 2.1 存款系统API设计
```typescript
// 存款方式枚举
enum DepositMethod {
  BANK_TRANSFER = 'bank_transfer',
  MOBILE_MONEY = 'mobile_money',
  PAYMENT_GATEWAY = 'payment_gateway',
  CRYPTOCURRENCY = 'cryptocurrency'
}

// 存款请求接口
interface DepositRequest {
  method: DepositMethod;
  amount: number;
  currency: 'NGN';
  paymentDetails: {
    // 银行转账
    bankName?: string;
    accountNumber?: string;
    // 移动货币
    provider?: 'OPAY' | 'PALMPAY' | 'MONIEPOINT';
    phoneNumber?: string;
  };
}

// 存款响应接口
interface DepositResponse {
  transactionId: string;
  status: 'PENDING' | 'PROCESSING' | 'COMPLETED' | 'FAILED';
  paymentInstructions?: {
    recipientBank?: string;
    recipientAccount?: string;
    reference?: string;
    qrCode?: string;
    walletAddress?: string;
  };
  expiryTime?: string;
}
```

#### 2.2 提款系统API设计
```typescript
interface WithdrawalRequest {
  method: 'bank' | 'mobile_money';
  amount: number;
  currency: 'NGN';
  destination: {
    bankAccountId?: string;
    mobileNumber?: string;
  };
  withdrawalPassword: string;
  verificationCode: string;
}

interface WithdrawalResponse {
  transactionId: string;
  status: 'PENDING' | 'PROCESSING' | 'COMPLETED' | 'REJECTED';
  processingTime: string;
  fee: number;
  netAmount: number;
}
```

#### 2.3 交易记录API
```typescript
interface TransactionRecord {
  id: string;
  type: 'DEPOSIT' | 'WITHDRAWAL' | 'ADJUSTMENT' | 'BONUS';
  amount: number;
  currency: string;
  status: 'PENDING' | 'COMPLETED' | 'FAILED';
  method: string;
  createdAt: string;
  completedAt?: string;
  reference: string;
  description: string;
}

// 查询接口
interface TransactionQuery {
  type?: string;
  status?: string;
  startDate?: string;
  endDate?: string;
  page: number;
  limit: number;
}
```

### 3. 刮刮乐核心模块

#### 3.1 "666"刮刮乐API设计
```typescript
// 刮刮乐卡片结构（简化版，移除拼图功能）
interface ScratchCard {
  id: string;
  type: '666';
  price: number;
  maxPrize: number;
  areas: ScratchArea[];
}

interface ScratchArea {
  id: string;
  symbol: '6' | '66' | '666' | 'EMPTY';
  baseAmount: number;
  multiplier: 1 | 2 | 3;
  isScratched: boolean;
}

// 购买刮刮乐
interface PurchaseScratchCardRequest {
  cardType: '666';
  quantity: number;
  autoScratch: boolean;
}

interface PurchaseScratchCardResponse {
  cards: ScratchCard[];
  totalCost: number;
  winnings: number;
}

// 刮开卡片
interface ScratchCardRequest {
  cardId: string;
  areaIds?: string[]; // 如果为空则全部刮开
}

interface ScratchCardResponse {
  card: ScratchCard;
  winnings: number;
}
```



### 4. 大乐透彩票模块

#### 4.1 大乐透 API设计
```typescript
interface SuperLottoDraw {
  drawId: string;
  drawNumber: string; // 期号
  drawTime: string;
  closeTime: string;
  frontNumbers: number[]; // 前区号码 (5个)
  backNumbers: number[];  // 后区号码 (2个)
  jackpot: number;        // 奖池金额
  status: 'OPEN' | 'CLOSED' | 'DRAWN';
  salesAmount: number;    // 销售总额
}

interface SuperLottoBet {
  frontNumbers: number[]; // 前区选择 1-35 选5个
  backNumbers: number[];  // 后区选择 1-12 选2个
  betType: 'SINGLE' | 'MULTIPLE' | 'COMPOUND'; // 单式/复式/胆拖
  amount: number;
  multiplier: number;
}

interface SuperLottoResult {
  prize: 'FIRST' | 'SECOND' | 'THIRD' | 'FOURTH' | 'FIFTH' | 'SIXTH' | 'SEVENTH' | 'EIGHTH' | 'NINTH';
  winAmount: number;
  description: string;
}

// 投注接口
interface PlaceSuperLottoBetRequest {
  drawId: string;
  bets: SuperLottoBet[];
  totalAmount: number;
}

// 奖级设置
interface PrizeLevel {
  level: number;
  name: string;
  condition: string;
  baseAmount?: number;
  percentage?: number; // 奖池分配比例
}

const SUPER_LOTTO_PRIZES: PrizeLevel[] = [
  { level: 1, name: '一等奖', condition: '5+2', percentage: 75 },
  { level: 2, name: '二等奖', condition: '5+1', percentage: 18 },
  { level: 3, name: '三等奖', condition: '5+0', baseAmount: 10000 },
  { level: 4, name: '四等奖', condition: '4+2', baseAmount: 3000 },
  { level: 5, name: '五等奖', condition: '4+1', baseAmount: 300 },
  { level: 6, name: '六等奖', condition: '3+2', baseAmount: 200 },
  { level: 7, name: '七等奖', condition: '4+0', baseAmount: 100 },
  { level: 8, name: '八等奖', condition: '3+1或2+2', baseAmount: 15 },
  { level: 9, name: '九等奖', condition: '3+0或1+2或2+1或0+2', baseAmount: 5 }
];
```

### 5. 11选5彩票模块

#### 5.1 11选5 API设计
```typescript
interface LotteryDraw {
  drawId: string;
  drawNumber: string; // 期号
  drawTime: string;
  closeTime: string;
  winningNumbers: number[];
  status: 'OPEN' | 'CLOSED' | 'DRAWN';
}

interface BetOption {
  type: 'FIXED_POSITION' | 'ANY_SELECT';
  position?: 1 | 2 | 3 | 4 | 5; // 定位胆位置
  selectCount?: number; // 任选数量
  numbers: number[];
  odds: number;
}

interface PlaceBetRequest {
  drawId: string;
  bets: {
    type: 'FIXED_POSITION' | 'ANY_SELECT';
    position?: number;
    numbers: number[];
    amount: number;
    multiplier: number;
  }[];
}

interface BetRecord {
  id: string;
  drawId: string;
  drawNumber: string;
  betType: string;
  numbers: number[];
  amount: number;
  multiplier: number;
  potentialWin: number;
  actualWin?: number;
  status: 'PENDING' | 'WIN' | 'LOSE';
  createdAt: string;
}

// 走势分析数据
interface TrendAnalysis {
  drawNumber: string;
  winningNumbers: number[];
  positions: {
    [position: number]: {
      number: number;
      missCount: number; // 遗漏值
    };
  };
  hotNumbers: number[];
  coldNumbers: number[];
}
```

### 5. 体育博彩集成模块

#### 5.1 第三方体育平台集成
```typescript
interface SportsProvider {
  id: string;
  name: string;
  logo: string;
  description: string;
  isActive: boolean;
  isMaintenance: boolean;
  features: string[];
  entryUrl: string;
}

interface WalletTransfer {
  fromWallet: 'MAIN' | 'SPORTS';
  toWallet: 'MAIN' | 'SPORTS';
  amount: number;
  providerId: string;
}

// 获取体育平台列表
interface GetSportsProvidersResponse {
  providers: SportsProvider[];
  userBalance: {
    mainWallet: number;
    sportsWallets: {
      [providerId: string]: number;
    };
  };
}
```

### 6. 统一返水奖励系统

#### 6.1 VIP等级与统一奖励机制（一对一映射）
```typescript
interface VIPLevel {
  level: number;
  name: string;
  requiredDeposit: number; // 升级所需累计充值金额
  rebateRate: number; // 个人返水比例
  referralDepth: number; // 推荐层级深度（与VIP等级一对一映射）
  referralRates: number[]; // 推荐奖励比例（7级递减）
  dailyWithdrawLimit: number;
  dailyWithdrawTimes: number;
  withdrawalFeeRate: number; // 提现手续费率
  privileges: string[];
}

// VIP等级配置（VIP0-VIP7，7级推荐奖励递减）
const VIP_LEVELS: VIPLevel[] = [
  { 
    level: 0, name: 'VIP0', 
    requiredDeposit: 0, // 无充值要求
    requiredTurnover: 0, // 无流水要求
    rebateRate: 0.0038, referralDepth: 1, 
    referralRates: [0.03], // 一级3%
    dailyWithdrawLimit: 50000, dailyWithdrawTimes: 3,
    withdrawalFeeRate: 0.02, // 2%手续费
    privileges: ['基础客服']
  },
  { 
    level: 1, name: 'VIP1', 
    requiredDeposit: 5000, // ₦5,000累计充值
    requiredTurnover: 10000, // ₦10,000累计流水
    rebateRate: 0.0040, referralDepth: 2,
    referralRates: [0.03, 0.02], // 一级3%，二级2%
    dailyWithdrawLimit: 100000, dailyWithdrawTimes: 5,
    withdrawalFeeRate: 0.015, // 1.5%手续费
    privileges: ['基础客服', '周返水']
  },
  { 
    level: 2, name: 'VIP2', 
    requiredDeposit: 20000, // ₦20,000累计充值
    requiredTurnover: 50000, // ₦50,000累计流水
    rebateRate: 0.0045, referralDepth: 3,
    referralRates: [0.03, 0.02, 0.01], // 一级3%，二级2%，三级1%
    dailyWithdrawLimit: 200000, dailyWithdrawTimes: 8,
    withdrawalFeeRate: 0.01, // 1%手续费
    privileges: ['专属客服', '周返水', '月礼金']
  },
  { 
    level: 3, name: 'VIP3', 
    requiredDeposit: 50000, // ₦50,000累计充值
    requiredTurnover: 100000, // ₦100,000累计流水
    rebateRate: 0.0050, referralDepth: 4,
    referralRates: [0.03, 0.02, 0.01, 0.007], // 一级3%，二级2%，三级1%，四级0.7%
    dailyWithdrawLimit: 300000, dailyWithdrawTimes: 10,
    withdrawalFeeRate: 0.008, // 0.8%手续费
    privileges: ['专属客服', '周返水', '月礼金', '生日礼金']
  },
  { 
    level: 4, name: 'VIP4', 
    requiredDeposit: 100000, // ₦100,000累计充值
    requiredTurnover: 200000, // ₦200,000累计流水
    rebateRate: 0.0055, referralDepth: 5,
    referralRates: [0.03, 0.02, 0.01, 0.007, 0.005], // 一级3%，二级2%，三级1%，四级0.7%，五级0.5%
    dailyWithdrawLimit: 500000, dailyWithdrawTimes: 12,
    withdrawalFeeRate: 0.006, // 0.6%手续费
    privileges: ['专属客服', '周返水', '月礼金', '生日礼金', '节日礼包']
  },
  { 
    level: 5, name: 'VIP5', 
    requiredDeposit: 200000, // ₦200,000累计充值
    requiredTurnover: 500000, // ₦500,000累计流水
    rebateRate: 0.0060, referralDepth: 6,
    referralRates: [0.03, 0.02, 0.01, 0.007, 0.005, 0.003], // 一级3%，二级2%，三级1%，四级0.7%，五级0.5%，六级0.3%
    dailyWithdrawLimit: 800000, dailyWithdrawTimes: 15,
    withdrawalFeeRate: 0.004, // 0.4%手续费
    privileges: ['专属客服', '周返水', '月礼金', '生日礼金', '节日礼包', '专属活动']
  },
  { 
    level: 6, name: 'VIP6', 
    requiredDeposit: 500000, // ₦500,000累计充值
    requiredTurnover: 1000000, // ₦1,000,000累计流水
    rebateRate: 0.0070, referralDepth: 7,
    referralRates: [0.03, 0.02, 0.01, 0.007, 0.005, 0.003, 0.001], // 完整7级递减
    dailyWithdrawLimit: 1000000, dailyWithdrawTimes: 20,
    withdrawalFeeRate: 0.002, // 0.2%手续费
    privileges: ['专属客服', '周返水', '月礼金', '生日礼金', '节日礼包', '专属活动', '绿色通道']
  },
  { 
    level: 7, name: 'VIP7', 
    requiredDeposit: 1000000, // ₦1,000,000累计充值
    requiredTurnover: 2000000, // ₦2,000,000累计流水
    rebateRate: 0.0080, referralDepth: 7,
    referralRates: [0.03, 0.02, 0.01, 0.007, 0.005, 0.003, 0.001], // 完整7级递减
    dailyWithdrawLimit: 1500000, dailyWithdrawTimes: 25,
    withdrawalFeeRate: 0, // 免手续费
    privileges: ['专属客服', '周返水', '月礼金', '生日礼金', '节日礼包', '专属活动', '绿色通道', '免手续费']
  }
];

interface UserVIPStatus {
  currentLevel: number;
  // 充值相关
  totalDeposit: number; // 累计充值金额
  nextLevelDeposit: number; // 下一级所需充值金额
  depositProgress: number; // 充值进度百分比
  // 流水相关
  currentTurnover: number; // 累计流水
  nextLevelTurnover: number; // 下一级所需流水
  turnoverProgress: number; // 流水进度百分比
  // VIP特权
  rebateRate: number; // 个人返水比例
  referralDepth: number; // 当前VIP等级对应的推荐层级深度
  referralRate: number; // 统一的推荐奖励比例
  withdrawalFeeRate: number; // 提现手续费率
  dailyWithdrawLimit: number; // 每日提款限额
  dailyWithdrawTimes: number; // 每日提款次数
  // 奖励统计
  totalRebateEarned: number;
  referralCode: string;
  directReferrals: number;
  totalTeamSize: number;
  totalReferralEarned: number;
  // 升级提示
  upgradeRequirement: {
    needsDeposit: boolean;
    needsTurnover: boolean;
    missingDeposit: number;
    missingTurnover: number;
  };
}

// 统一奖励计算（简化版）
interface RewardCalculation {
  userId: string;
  period: string; // 日期
  vipLevel: number;
  // 个人返水
  personalTurnover: number;
  personalRebateRate: number;
  personalRebateAmount: number;
  // 推荐奖励（基于VIP等级的层级深度）
  referralTurnover: number;
  referralDepth: number; // 基于VIP等级确定的推荐深度
  referralRate: number; // 统一的推荐比例
  referralBonusAmount: number;
  // 总计
  totalReward: number;
  status: 'PENDING' | 'PAID';
}
```

#### 6.2 统一奖励系统API
```typescript
// 获取用户奖励概览
interface GetUserRewardsResponse {
  vipStatus: UserVIPStatus;
  currentPeriodRewards: RewardCalculation;
  recentRewards: RewardCalculation[];
  referralTree: {
    level: number;
    users: {
      username: string;
      joinDate: string;
      contribution: number;
    }[];
  }[];
}

// 奖励发放接口
interface DistributeRewardsRequest {
  period: string;
  userIds?: string[]; // 如果为空则处理所有用户
}

// 奖励查询接口
interface RewardQuery {
  userId?: string;
  period?: string;
  type?: 'REBATE' | 'REFERRAL' | 'ALL';
  status?: 'PENDING' | 'PAID';
  page: number;
  limit: number;
}
```

## 前端界面设计规范

### 1. 设计系统

#### 1.1 色彩规范
```css
:root {
  /* 主色调 - 适合非洲市场的暖色系 */
  --primary-color: #FF6B35;      /* 橙红色 - 主要按钮 */
  --secondary-color: #F7931E;    /* 橙色 - 次要元素 */
  --accent-color: #FFD23F;       /* 金黄色 - 强调/奖金 */
  
  /* 功能色彩 */
  --success-color: #27AE60;      /* 绿色 - 成功状态 */
  --warning-color: #F39C12;      /* 黄色 - 警告 */
  --error-color: #E74C3C;        /* 红色 - 错误 */
  --info-color: #3498DB;         /* 蓝色 - 信息 */
  
  /* 中性色 */
  --text-primary: #2C3E50;       /* 主要文字 */
  --text-secondary: #7F8C8D;     /* 次要文字 */
  --background-primary: #FFFFFF; /* 主背景 */
  --background-secondary: #F8F9FA; /* 次背景 */
  --border-color: #E9ECEF;       /* 边框色 */
}
```

#### 1.2 字体规范
```css
/* 字体系统 */
.font-system {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 
               'Roboto', 'Helvetica Neue', Arial, sans-serif;
}

/* 字号规范 */
.text-xs { font-size: 12px; }    /* 辅助信息 */
.text-sm { font-size: 14px; }    /* 次要文字 */
.text-base { font-size: 16px; }  /* 正文 */
.text-lg { font-size: 18px; }    /* 小标题 */
.text-xl { font-size: 20px; }    /* 标题 */
.text-2xl { font-size: 24px; }   /* 大标题 */
.text-3xl { font-size: 30px; }   /* 特大标题 */
```

### 2. 组件设计规范

#### 2.1 按钮组件
```typescript
interface ButtonProps {
  variant: 'primary' | 'secondary' | 'outline' | 'ghost';
  size: 'sm' | 'md' | 'lg';
  loading?: boolean;
  disabled?: boolean;
  fullWidth?: boolean;
  children: React.ReactNode;
  onClick?: () => void;
}

// 使用示例
<Button variant="primary" size="lg" fullWidth>
  立即投注
</Button>
```

#### 2.2 输入框组件
```typescript
interface InputProps {
  type: 'text' | 'number' | 'password' | 'tel';
  placeholder: string;
  value: string;
  onChange: (value: string) => void;
  error?: string;
  prefix?: React.ReactNode;
  suffix?: React.ReactNode;
  disabled?: boolean;
}
```

#### 2.3 卡片组件
```typescript
interface CardProps {
  title?: string;
  extra?: React.ReactNode;
  children: React.ReactNode;
  className?: string;
  hoverable?: boolean;
}
```

### 3. 响应式设计规范

#### 3.1 断点设置
```css
/* 响应式断点 */
@media (min-width: 640px) { /* sm */ }
@media (min-width: 768px) { /* md */ }
@media (min-width: 1024px) { /* lg */ }
@media (min-width: 1280px) { /* xl */ }
```

#### 3.2 移动端优化
- 触摸友好的按钮尺寸 (最小44px)
- 适合单手操作的布局
- 优化的滚动体验
- 快速加载的图片和资源

## Django后端API架构设计

### 1. Django REST Framework API设计

#### 1.1 URL路由配置
```python
# urls.py - 主路由配置
from django.urls import path, include
from rest_framework.routers import DefaultRouter

# API版本化路由
urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/v1/auth/', include('apps.authentication.urls')),
    path('api/v1/users/', include('apps.users.urls')),
    path('api/v1/finance/', include('apps.finance.urls')),
    path('api/v1/games/', include('apps.games.urls')),
    path('api/v1/rewards/', include('apps.rewards.urls')),
    path('api/v1/sports/', include('apps.sports.urls')),
]

# apps/authentication/urls.py
urlpatterns = [
    path('register/', RegisterView.as_view(), name='register'),
    path('login/', LoginView.as_view(), name='login'),
    path('logout/', LogoutView.as_view(), name='logout'),
    path('refresh/', TokenRefreshView.as_view(), name='token_refresh'),
    path('verify-phone/', VerifyPhoneView.as_view(), name='verify_phone'),
]

# apps/finance/urls.py
urlpatterns = [
    path('balance/', BalanceView.as_view(), name='balance'),
    path('deposit/', DepositView.as_view(), name='deposit'),
    path('withdraw/', WithdrawView.as_view(), name='withdraw'),
    path('transactions/', TransactionListView.as_view(), name='transactions'),
    path('bank-accounts/', BankAccountViewSet.as_view({'get': 'list', 'post': 'create'})),
]

# apps/games/urls.py
urlpatterns = [
    path('scratch/purchase/', ScratchPurchaseView.as_view(), name='scratch_purchase'),
    path('scratch/reveal/', ScratchRevealView.as_view(), name='scratch_reveal'),
    path('puzzle/progress/', PuzzleProgressView.as_view(), name='puzzle_progress'),
    path('lottery/current-draw/', CurrentDrawView.as_view(), name='current_draw'),
    path('lottery/place-bet/', PlaceBetView.as_view(), name='place_bet'),
    path('super-lotto/current-draw/', SuperLottoCurrentDrawView.as_view()),
    path('super-lotto/place-bet/', SuperLottoPlaceBetView.as_view()),
]
```

#### 1.2 Django统一响应格式
```python
# utils/response.py - 统一响应处理
from rest_framework.response import Response
from rest_framework import status
from django.utils import timezone

class APIResponse:
    @staticmethod
    def success(data=None, message="操作成功", code=200):
        return Response({
            'success': True,
            'code': code,
            'message': message,
            'data': data,
            'timestamp': int(timezone.now().timestamp())
        }, status=code)
    
    @staticmethod
    def error(message="操作失败", code=400, data=None):
        return Response({
            'success': False,
            'code': code,
            'message': message,
            'data': data,
            'timestamp': int(timezone.now().timestamp())
        }, status=code)

# 自定义异常处理
from rest_framework.views import exception_handler
from django.http import Http404
from rest_framework.exceptions import ValidationError

def custom_exception_handler(exc, context):
    response = exception_handler(exc, context)
    
    if response is not None:
        if isinstance(exc, Http404):
            return APIResponse.error("资源不存在", 404)
        elif isinstance(exc, ValidationError):
            return APIResponse.error("参数验证失败", 400, response.data)
        else:
            return APIResponse.error(str(exc), response.status_code)
    
    return response
```

#### 1.3 Django错误码管理
```python
# utils/error_codes.py - 错误码定义
class ErrorCode:
    # 通用错误 1000-1999
    INVALID_PARAMS = 1001
    UNAUTHORIZED = 1002
    FORBIDDEN = 1003
    NOT_FOUND = 1004
    
    # 用户相关 2000-2999
    USER_NOT_FOUND = 2001
    INVALID_CREDENTIALS = 2002
    ACCOUNT_LOCKED = 2003
    PHONE_ALREADY_EXISTS = 2004
    EMAIL_ALREADY_EXISTS = 2005
    
    # 财务相关 3000-3999
    INSUFFICIENT_BALANCE = 3001
    INVALID_AMOUNT = 3002
    PAYMENT_FAILED = 3003
    WITHDRAWAL_LIMIT_EXCEEDED = 3004
    BANK_ACCOUNT_NOT_VERIFIED = 3005
    
    # 游戏相关 4000-4999
    GAME_NOT_AVAILABLE = 4001
    BET_LIMIT_EXCEEDED = 4002
    DRAW_CLOSED = 4003
    INVALID_NUMBERS = 4004
    CARD_ALREADY_SCRATCHED = 4005
    
    # 奖励相关 5000-5999
    REWARD_ALREADY_CLAIMED = 5001
    PUZZLE_NOT_COMPLETED = 5002
    VIP_LEVEL_INSUFFICIENT = 5003

# 错误消息映射
ERROR_MESSAGES = {
    ErrorCode.INVALID_PARAMS: "参数错误",
    ErrorCode.UNAUTHORIZED: "未授权访问",
    ErrorCode.INSUFFICIENT_BALANCE: "余额不足",
    ErrorCode.BET_LIMIT_EXCEEDED: "投注金额超限",
    # ... 更多错误消息
}
```

### 2. Django模型设计

#### 2.1 用户认证模型
```python
# apps/users/models.py
from django.contrib.auth.models import AbstractUser
from django.db import models
from django.core.validators import RegexValidator
import uuid

class User(AbstractUser):
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    phone_regex = RegexValidator(regex=r'^\+?1?\d{9,15}$')
    phone = models.CharField(validators=[phone_regex], max_length=17, unique=True)
    country = models.CharField(max_length=2, default='NG', db_index=True)
    full_name = models.CharField(max_length=100, blank=True)
    date_of_birth = models.DateField(null=True, blank=True)
    gender = models.CharField(max_length=10, blank=True)
    address = models.TextField(blank=True)
    
    # KYC相关
    kyc_status = models.CharField(max_length=20, default='PENDING', db_index=True)
    kyc_data = models.JSONField(default=dict, blank=True)
    
    # VIP相关
    vip_level = models.IntegerField(default=0, db_index=True)
    total_turnover = models.DecimalField(max_digits=15, decimal_places=2, default=0)
    
    # 推荐相关
    referral_code = models.CharField(max_length=20, unique=True, db_index=True)
    referred_by = models.ForeignKey('self', null=True, blank=True, on_delete=models.SET_NULL)
    
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'users'
        indexes = [
            models.Index(fields=['phone', 'is_active']),
            models.Index(fields=['vip_level', 'total_turnover']),
            models.Index(fields=['referral_code']),
            models.Index(fields=['country', 'is_active']),
        ]
    
    def save(self, *args, **kwargs):
        if not self.referral_code:
            self.referral_code = self.generate_referral_code()
        super().save(*args, **kwargs)
    
    def generate_referral_code(self):
        import random, string
        return ''.join(random.choices(string.ascii_uppercase + string.digits, k=8))

class UserProfile(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE, related_name='profile')
    avatar = models.ImageField(upload_to='avatars/', blank=True)
    timezone = models.CharField(max_length=50, default='Africa/Lagos')
    language = models.CharField(max_length=10, default='en')
    notification_preferences = models.JSONField(default=dict)
    
    class Meta:
        db_table = 'user_profiles'
```

#### 2.2 财务系统模型
```python
# apps/finance/models.py
from django.db import models
from django.contrib.auth import get_user_model
from decimal import Decimal
import uuid

User = get_user_model()

class UserBalance(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE, primary_key=True)
    main_balance = models.DecimalField(max_digits=15, decimal_places=2, default=Decimal('0.00'))
    bonus_balance = models.DecimalField(max_digits=15, decimal_places=2, default=Decimal('0.00'))
    frozen_balance = models.DecimalField(max_digits=15, decimal_places=2, default=Decimal('0.00'))
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'user_balances'
    
    @property
    def total_balance(self):
        return self.main_balance + self.bonus_balance
    
    def can_withdraw(self, amount):
        return self.main_balance >= amount

class Transaction(models.Model):
    TRANSACTION_TYPES = [
        ('DEPOSIT', '存款'),
        ('WITHDRAWAL', '提款'),
        ('BET', '投注'),
        ('WIN', '中奖'),
        ('REBATE', '返水'),
        ('REFERRAL_BONUS', '推荐奖励'),
        ('ADJUSTMENT', '调整'),
    ]
    
    TRANSACTION_STATUS = [
        ('PENDING', '待处理'),
        ('PROCESSING', '处理中'),
        ('COMPLETED', '已完成'),
        ('FAILED', '失败'),
        ('CANCELLED', '已取消'),
    ]
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    user = models.ForeignKey(User, on_delete=models.CASCADE, db_index=True)
    type = models.CharField(max_length=20, choices=TRANSACTION_TYPES, db_index=True)
    amount = models.DecimalField(max_digits=15, decimal_places=2)
    currency = models.CharField(max_length=10, default='NGN')
    status = models.CharField(max_length=20, choices=TRANSACTION_STATUS, default='PENDING', db_index=True)
    method = models.CharField(max_length=50, blank=True)
    reference = models.CharField(max_length=100, blank=True, db_index=True)
    description = models.TextField(blank=True)
    metadata = models.JSONField(default=dict, blank=True)
    created_at = models.DateTimeField(auto_now_add=True, db_index=True)
    completed_at = models.DateTimeField(null=True, blank=True)
    
    class Meta:
        db_table = 'transactions'
        indexes = [
            models.Index(fields=['user', 'created_at']),
            models.Index(fields=['type', 'status']),
            models.Index(fields=['reference']),
        ]

class BankAccount(models.Model):
    NIGERIAN_BANKS = [
        ('ACCESS', 'Access Bank'),
        ('GTB', 'Guaranty Trust Bank'),
        ('ZENITH', 'Zenith Bank'),
        ('UBA', 'United Bank for Africa'),
        ('FIRST_BANK', 'First Bank of Nigeria'),
        # ... 更多银行
    ]
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    bank_name = models.CharField(max_length=100, choices=NIGERIAN_BANKS)
    account_name = models.CharField(max_length=100)
    account_number = models.CharField(max_length=50)
    is_verified = models.BooleanField(default=False)
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
    
    class Meta:
        db_table = 'user_bank_accounts'
        unique_together = ['user', 'account_number']
```

#### 2.3 游戏系统模型
```python
# apps/games/models.py
from django.db import models
from django.contrib.auth import get_user_model
import uuid, json

User = get_user_model()

class ScratchCard(models.Model):
    CARD_TYPES = [
        ('666', '666刮刮乐'),
    ]
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    user = models.ForeignKey(User, on_delete=models.CASCADE, db_index=True)
    card_type = models.CharField(max_length=20, choices=CARD_TYPES, default='666')
    price = models.DecimalField(max_digits=10, decimal_places=2)
    areas = models.JSONField()  # 刮奖区域数据
    total_winnings = models.DecimalField(max_digits=10, decimal_places=2, default=0)
    is_scratched = models.BooleanField(default=False, db_index=True)
    puzzle_piece = models.ForeignKey('PuzzlePiece', null=True, blank=True, on_delete=models.SET_NULL)
    created_at = models.DateTimeField(auto_now_add=True)
    scratched_at = models.DateTimeField(null=True, blank=True)
    
    class Meta:
        db_table = 'scratch_cards'
        indexes = [
            models.Index(fields=['user', 'created_at']),
            models.Index(fields=['card_type', 'is_scratched']),
        ]

class PuzzleSeries(models.Model):
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    name = models.CharField(max_length=100)
    theme = models.CharField(max_length=100)
    total_pieces = models.IntegerField()
    completion_reward = models.JSONField()
    image_url = models.URLField(blank=True)
    is_active = models.BooleanField(default=True, db_index=True)
    created_at = models.DateTimeField(auto_now_add=True)
    
    class Meta:
        db_table = 'puzzle_series'

class SuperLottoDraw(models.Model):
    DRAW_STATUS = [
        ('OPEN', '开放投注'),
        ('CLOSED', '停止投注'),
        ('DRAWN', '已开奖'),
    ]
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    draw_number = models.CharField(max_length=50, unique=True, db_index=True)
    draw_time = models.DateTimeField(db_index=True)
    close_time = models.DateTimeField(db_index=True)
    front_numbers = models.JSONField(default=list)  # 前区5个号码
    back_numbers = models.JSONField(default=list)   # 后区2个号码
    jackpot = models.DecimalField(max_digits=15, decimal_places=2, default=0)
    sales_amount = models.DecimalField(max_digits=15, decimal_places=2, default=0)
    status = models.CharField(max_length=20, choices=DRAW_STATUS, default='OPEN', db_index=True)
    created_at = models.DateTimeField(auto_now_add=True)
    
    class Meta:
        db_table = 'super_lotto_draws'
        ordering = ['-draw_time']

class SuperLottoBet(models.Model):
    BET_TYPES = [
        ('SINGLE', '单式'),
        ('MULTIPLE', '复式'),
        ('COMPOUND', '胆拖'),
    ]
    
    BET_STATUS = [
        ('PENDING', '待开奖'),
        ('WIN', '中奖'),
        ('LOSE', '未中奖'),
    ]
    
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    user = models.ForeignKey(User, on_delete=models.CASCADE, db_index=True)
    draw = models.ForeignKey(SuperLottoDraw, on_delete=models.CASCADE, db_index=True)
    bet_type = models.CharField(max_length=20, choices=BET_TYPES)
    front_numbers = models.JSONField()
    back_numbers = models.JSONField()
    amount = models.DecimalField(max_digits=10, decimal_places=2)
    multiplier = models.IntegerField(default=1)
    potential_win = models.DecimalField(max_digits=15, decimal_places=2)
    actual_win = models.DecimalField(max_digits=15, decimal_places=2, default=0)
    prize_level = models.IntegerField(null=True, blank=True)  # 中奖等级 1-9
    status = models.CharField(max_length=20, choices=BET_STATUS, default='PENDING', db_index=True)
    created_at = models.DateTimeField(auto_now_add=True)
    
    class Meta:
        db_table = 'super_lotto_bets'
        indexes = [
            models.Index(fields=['user', 'created_at']),
            models.Index(fields=['draw', 'status']),
        ]
```

### 3. Django API视图实现

#### 3.1 用户认证视图
```python
# apps/authentication/views.py
from rest_framework import status
from rest_framework.decorators import api_view, permission_classes
from rest_framework.permissions import AllowAny
from rest_framework_simplejwt.tokens import RefreshToken
from django.contrib.auth import authenticate
from django.core.cache import cache
from utils.response import APIResponse
from utils.error_codes import ErrorCode
from .serializers import RegisterSerializer, LoginSerializer

@api_view(['POST'])
@permission_classes([AllowAny])
def register_view(request):
    """用户注册"""
    serializer = RegisterSerializer(data=request.data)
    if serializer.is_valid():
        user = serializer.save()
        
        # 生成JWT令牌
        refresh = RefreshToken.for_user(user)
        
        # 创建用户余额记录
        from apps.finance.models import UserBalance
        UserBalance.objects.create(user=user)
        
        return APIResponse.success({
            'user': {
                'id': str(user.id),
                'username': user.username,
                'phone': user.phone,
                'referral_code': user.referral_code
            },
            'tokens': {
                'access': str(refresh.access_token),
                'refresh': str(refresh)
            }
        }, "注册成功")
    
    return APIResponse.error("注册失败", ErrorCode.INVALID_PARAMS, serializer.errors)

@api_view(['POST'])
@permission_classes([AllowAny])
def login_view(request):
    """用户登录"""
    serializer = LoginSerializer(data=request.data)
    if serializer.is_valid():
        identifier = serializer.validated_data['identifier']
        password = serializer.validated_data['password']
        
        # 支持用户名/邮箱/手机号登录
        user = authenticate_user(identifier, password)
        
        if user:
            if not user.is_active:
                return APIResponse.error("账户已被禁用", ErrorCode.ACCOUNT_LOCKED)
            
            # 生成JWT令牌
            refresh = RefreshToken.for_user(user)
            
            # 缓存用户信息
            cache.set(f'user_info_{user.id}', {
                'username': user.username,
                'vip_level': user.vip_level,
                'phone': user.phone
            }, 3600)
            
            return APIResponse.success({
                'user': {
                    'id': str(user.id),
                    'username': user.username,
                    'phone': user.phone,
                    'vip_level': user.vip_level
                },
                'tokens': {
                    'access': str(refresh.access_token),
                    'refresh': str(refresh)
                }
            }, "登录成功")
        
        return APIResponse.error("用户名或密码错误", ErrorCode.INVALID_CREDENTIALS)
    
    return APIResponse.error("参数错误", ErrorCode.INVALID_PARAMS, serializer.errors)

def authenticate_user(identifier, password):
    """多方式用户认证"""
    from django.contrib.auth import get_user_model
    User = get_user_model()
    
    # 尝试用户名登录
    user = authenticate(username=identifier, password=password)
    if user:
        return user
    
    # 尝试邮箱登录
    try:
        user = User.objects.get(email=identifier)
        if user.check_password(password):
            return user
    except User.DoesNotExist:
        pass
    
    # 尝试手机号登录
    try:
        user = User.objects.get(phone=identifier)
        if user.check_password(password):
            return user
    except User.DoesNotExist:
        pass
    
    return None
```

#### 3.2 财务系统视图
```python
# apps/finance/views.py
from rest_framework import status
from rest_framework.decorators import api_view, permission_classes
from rest_framework.permissions import IsAuthenticated
from django.db import transaction
from django.core.cache import cache
from utils.response import APIResponse
from utils.error_codes import ErrorCode
from .models import UserBalance, Transaction, BankAccount
from .serializers import DepositSerializer, WithdrawSerializer
from .tasks import process_deposit_async, process_withdrawal_async

@api_view(['GET'])
@permission_classes([IsAuthenticated])
def get_balance(request):
    """获取用户余额"""
    user_id = request.user.id
    
    # 先从缓存获取
    cache_key = f'user_balance_{user_id}'
    balance_data = cache.get(cache_key)
    
    if balance_data is None:
        try:
            balance = UserBalance.objects.get(user=request.user)
            balance_data = {
                'main_balance': float(balance.main_balance),
                'bonus_balance': float(balance.bonus_balance),
                'frozen_balance': float(balance.frozen_balance),
                'total_balance': float(balance.total_balance)
            }
            cache.set(cache_key, balance_data, 300)  # 缓存5分钟
        except UserBalance.DoesNotExist:
            # 如果不存在余额记录，创建一个
            balance = UserBalance.objects.create(user=request.user)
            balance_data = {
                'main_balance': 0.00,
                'bonus_balance': 0.00,
                'frozen_balance': 0.00,
                'total_balance': 0.00
            }
    
    return APIResponse.success(balance_data)

@api_view(['POST'])
@permission_classes([IsAuthenticated])
def create_deposit(request):
    """创建存款请求"""
    serializer = DepositSerializer(data=request.data)
    if serializer.is_valid():
        with transaction.atomic():
            # 创建交易记录
            deposit_transaction = Transaction.objects.create(
                user=request.user,
                type='DEPOSIT',
                amount=serializer.validated_data['amount'],
                currency='NGN',
                method=serializer.validated_data['method'],
                status='PENDING',
                metadata=serializer.validated_data.get('payment_details', {})
            )
            
            # 异步处理存款
            process_deposit_async.delay(str(deposit_transaction.id))
            
            # 生成支付指令
            payment_instructions = generate_payment_instructions(
                serializer.validated_data['method'],
                serializer.validated_data['amount'],
                str(deposit_transaction.id)
            )
            
            return APIResponse.success({
                'transaction_id': str(deposit_transaction.id),
                'status': 'PENDING',
                'payment_instructions': payment_instructions
            }, "存款请求已创建")
    
    return APIResponse.error("参数错误", ErrorCode.INVALID_PARAMS, serializer.errors)

@api_view(['POST'])
@permission_classes([IsAuthenticated])
def create_withdrawal(request):
    """创建提款请求"""
    serializer = WithdrawSerializer(data=request.data)
    if serializer.is_valid():
        amount = serializer.validated_data['amount']
        
        # 检查余额
        try:
            balance = UserBalance.objects.get(user=request.user)
            if not balance.can_withdraw(amount):
                return APIResponse.error("余额不足", ErrorCode.INSUFFICIENT_BALANCE)
        except UserBalance.DoesNotExist:
            return APIResponse.error("余额不足", ErrorCode.INSUFFICIENT_BALANCE)
        
        # 检查提款限额
        daily_limit = get_user_daily_withdraw_limit(request.user)
        if amount > daily_limit:
            return APIResponse.error("超出每日提款限额", ErrorCode.WITHDRAWAL_LIMIT_EXCEEDED)
        
        with transaction.atomic():
            # 冻结余额
            balance.main_balance -= amount
            balance.frozen_balance += amount
            balance.save()
            
            # 创建提款记录
            withdrawal_transaction = Transaction.objects.create(
                user=request.user,
                type='WITHDRAWAL',
                amount=amount,
                currency='NGN',
                method=serializer.validated_data['method'],
                status='PENDING',
                metadata=serializer.validated_data.get('destination', {})
            )
            
            # 异步处理提款
            process_withdrawal_async.delay(str(withdrawal_transaction.id))
            
            # 清除余额缓存
            cache.delete(f'user_balance_{request.user.id}')
            
            return APIResponse.success({
                'transaction_id': str(withdrawal_transaction.id),
                'status': 'PENDING',
                'processing_time': '1-3个工作日'
            }, "提款请求已提交")
    
    return APIResponse.error("参数错误", ErrorCode.INVALID_PARAMS, serializer.errors)

def generate_payment_instructions(method, amount, reference):
    """生成支付指令"""
    if method == 'bank_transfer':
        return {
            'recipient_bank': 'GTBank',
            'recipient_account': '0123456789',
            'recipient_name': 'Lottery Platform Ltd',
            'reference': reference,
            'amount': amount,
            'note': '请在转账备注中填写参考号码'
        }
    elif method == 'mobile_money':
        return {
            'provider': 'OPay',
            'merchant_code': '123456',
            'reference': reference,
            'amount': amount,
            'qr_code': f'opay://pay?amount={amount}&ref={reference}'
        }
    # 其他支付方式...
    return {}

def get_user_daily_withdraw_limit(user):
    """获取用户每日提款限额"""
    # 根据VIP等级确定限额
    vip_limits = {
        0: 50000,   # VIP0: 5万奈拉
        1: 100000,  # VIP1: 10万奈拉
        2: 200000,  # VIP2: 20万奈拉
        # ... 更多等级
    }
    return vip_limits.get(user.vip_level, 50000)
```

#### 3.3 游戏系统视图
```python
# apps/games/views.py
from rest_framework import status
from rest_framework.decorators import api_view, permission_classes
from rest_framework.permissions import IsAuthenticated
from django.db import transaction
from django.utils import timezone
from utils.response import APIResponse
from utils.error_codes import ErrorCode
from .models import ScratchCard, SuperLottoDraw, SuperLottoBet
from .serializers import ScratchPurchaseSerializer, SuperLottoBetSerializer
from .services import ScratchCardService, SuperLottoService

@api_view(['POST'])
@permission_classes([IsAuthenticated])
def purchase_scratch_card(request):
    """购买刮刮乐"""
    serializer = ScratchPurchaseSerializer(data=request.data)
    if serializer.is_valid():
        quantity = serializer.validated_data['quantity']
        auto_scratch = serializer.validated_data.get('auto_scratch', False)
        
        # 检查余额
        total_cost = quantity * 100  # 假设每张100奈拉
        balance = request.user.userbalance
        if balance.main_balance < total_cost:
            return APIResponse.error("余额不足", ErrorCode.INSUFFICIENT_BALANCE)
        
        with transaction.atomic():
            # 扣除余额
            balance.main_balance -= total_cost
            balance.save()
            
            # 创建刮刮乐卡片
            cards = []
            total_winnings = 0
            puzzle_pieces = []
            
            for _ in range(quantity):
                card = ScratchCardService.create_card(request.user, '666')
                if auto_scratch:
                    winnings, puzzle_piece = ScratchCardService.scratch_card(card)
                    total_winnings += winnings
                    if puzzle_piece:
                        puzzle_pieces.append(puzzle_piece)
                cards.append(card)
            
            # 如果有中奖，增加余额
            if total_winnings > 0:
                balance.main_balance += total_winnings
                balance.save()
            
            # 清除缓存
            cache.delete(f'user_balance_{request.user.id}')
            
            return APIResponse.success({
                'cards': [{'id': str(card.id), 'is_scratched': card.is_scratched} for card in cards],
                'total_cost': total_cost,
                'total_winnings': total_winnings,
                'puzzle_pieces': len(puzzle_pieces)
            }, "购买成功")
    
    return APIResponse.error("参数错误", ErrorCode.INVALID_PARAMS, serializer.errors)

@api_view(['GET'])
@permission_classes([IsAuthenticated])
def get_current_super_lotto_draw(request):
    """获取当前大乐透期次"""
    try:
        current_draw = SuperLottoDraw.objects.filter(
            status='OPEN',
            close_time__gt=timezone.now()
        ).first()
        
        if not current_draw:
            return APIResponse.error("当前没有开放的期次", ErrorCode.GAME_NOT_AVAILABLE)
        
        return APIResponse.success({
            'draw_id': str(current_draw.id),
            'draw_number': current_draw.draw_number,
            'draw_time': current_draw.draw_time.isoformat(),
            'close_time': current_draw.close_time.isoformat(),
            'jackpot': float(current_draw.jackpot),
            'sales_amount': float(current_draw.sales_amount)
        })
    
    except Exception as e:
        return APIResponse.error("获取期次信息失败", ErrorCode.GAME_NOT_AVAILABLE)

@api_view(['POST'])
@permission_classes([IsAuthenticated])
def place_super_lotto_bet(request):
    """投注大乐透"""
    serializer = SuperLottoBetSerializer(data=request.data)
    if serializer.is_valid():
        draw_id = serializer.validated_data['draw_id']
        bets = serializer.validated_data['bets']
        
        try:
            draw = SuperLottoDraw.objects.get(id=draw_id, status='OPEN')
            if draw.close_time <= timezone.now():
                return APIResponse.error("投注已截止", ErrorCode.DRAW_CLOSED)
        except SuperLottoDraw.DoesNotExist:
            return APIResponse.error("期次不存在", ErrorCode.GAME_NOT_AVAILABLE)
        
        total_amount = sum(bet['amount'] * bet['multiplier'] for bet in bets)
        
        # 检查余额
        balance = request.user.userbalance
        if balance.main_balance < total_amount:
            return APIResponse.error("余额不足", ErrorCode.INSUFFICIENT_BALANCE)
        
        with transaction.atomic():
            # 扣除余额
            balance.main_balance -= total_amount
            balance.save()
            
            # 创建投注记录
            bet_records = []
            for bet_data in bets:
                bet_record = SuperLottoBet.objects.create(
                    user=request.user,
                    draw=draw,
                    bet_type=bet_data['bet_type'],
                    front_numbers=bet_data['front_numbers'],
                    back_numbers=bet_data['back_numbers'],
                    amount=bet_data['amount'],
                    multiplier=bet_data['multiplier'],
                    potential_win=SuperLottoService.calculate_potential_win(bet_data)
                )
                bet_records.append(bet_record)
            
            # 更新销售额
            draw.sales_amount += total_amount
            draw.save()
            
            # 清除缓存
            cache.delete(f'user_balance_{request.user.id}')
            
            return APIResponse.success({
                'bet_records': [str(bet.id) for bet in bet_records],
                'total_amount': total_amount,
                'draw_number': draw.draw_number
            }, "投注成功")
    
    return APIResponse.error("参数错误", ErrorCode.INVALID_PARAMS, serializer.errors)
```

### 2. Django数据库设计
```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    phone VARCHAR(20) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    country VARCHAR(2) NOT NULL DEFAULT 'NG',
    full_name VARCHAR(100),
    date_of_birth DATE,
    gender VARCHAR(10),
    address TEXT,
    kyc_status VARCHAR(20) DEFAULT 'PENDING',
    kyc_data JSONB,
    vip_level INTEGER DEFAULT 0,
    total_turnover DECIMAL(15,2) DEFAULT 0,
    referral_code VARCHAR(20) UNIQUE,
    referred_by UUID REFERENCES users(id),
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 2.2 财务相关表
```sql
-- 用户余额表
CREATE TABLE user_balances (
    user_id UUID PRIMARY KEY REFERENCES users(id),
    main_balance DECIMAL(15,2) DEFAULT 0,
    bonus_balance DECIMAL(15,2) DEFAULT 0,
    frozen_balance DECIMAL(15,2) DEFAULT 0,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 交易记录表
CREATE TABLE transactions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id),
    type VARCHAR(20) NOT NULL, -- DEPOSIT, WITHDRAWAL, BET, WIN, etc.
    amount DECIMAL(15,2) NOT NULL,
    currency VARCHAR(10) DEFAULT 'NGN',
    status VARCHAR(20) DEFAULT 'PENDING',
    method VARCHAR(50),
    reference VARCHAR(100),
    description TEXT,
    metadata JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP
);

-- 银行账户表
CREATE TABLE user_bank_accounts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id),
    bank_name VARCHAR(100) NOT NULL,
    account_name VARCHAR(100) NOT NULL,
    account_number VARCHAR(50) NOT NULL,
    is_verified BOOLEAN DEFAULT false,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 2.3 刮刮乐相关表
```sql
-- 刮刮乐卡片表
CREATE TABLE scratch_cards (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id),
    card_type VARCHAR(20) NOT NULL DEFAULT '666',
    price DECIMAL(10,2) NOT NULL,
    areas JSONB NOT NULL, -- 刮奖区域数据
    total_winnings DECIMAL(10,2) DEFAULT 0,
    is_scratched BOOLEAN DEFAULT false,
    puzzle_piece_id UUID,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    scratched_at TIMESTAMP
);

-- 拼图系列表
CREATE TABLE puzzle_series (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,
    theme VARCHAR(100) NOT NULL,
    total_pieces INTEGER NOT NULL,
    completion_reward JSONB NOT NULL,
    image_url VARCHAR(255),
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 拼图碎片表
CREATE TABLE puzzle_pieces (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    series_id UUID NOT NULL REFERENCES puzzle_series(id),
    piece_number INTEGER NOT NULL,
    image_url VARCHAR(255),
    rarity VARCHAR(20) DEFAULT 'COMMON',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 用户拼图收集表
CREATE TABLE user_puzzle_pieces (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id),
    piece_id UUID NOT NULL REFERENCES puzzle_pieces(id),
    obtained_from_card_id UUID REFERENCES scratch_cards(id),
    obtained_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, piece_id)
);
```

#### 2.4 大乐透彩票表
```sql
-- 大乐透期次表
CREATE TABLE super_lotto_draws (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    draw_number VARCHAR(50) UNIQUE NOT NULL,
    draw_time TIMESTAMP NOT NULL,
    close_time TIMESTAMP NOT NULL,
    front_numbers INTEGER[] DEFAULT '{}', -- 前区5个号码
    back_numbers INTEGER[] DEFAULT '{}',  -- 后区2个号码
    jackpot DECIMAL(15,2) DEFAULT 0,      -- 奖池金额
    sales_amount DECIMAL(15,2) DEFAULT 0, -- 销售总额
    status VARCHAR(20) DEFAULT 'OPEN',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 大乐透投注记录表
CREATE TABLE super_lotto_bets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id),
    draw_id UUID NOT NULL REFERENCES super_lotto_draws(id),
    bet_type VARCHAR(20) NOT NULL, -- SINGLE, MULTIPLE, COMPOUND
    front_numbers INTEGER[] NOT NULL,
    back_numbers INTEGER[] NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    multiplier INTEGER DEFAULT 1,
    potential_win DECIMAL(15,2) NOT NULL,
    actual_win DECIMAL(15,2) DEFAULT 0,
    prize_level INTEGER, -- 中奖等级 1-9
    status VARCHAR(20) DEFAULT 'PENDING',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 大乐透奖池管理表
CREATE TABLE super_lotto_jackpot (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    draw_id UUID NOT NULL REFERENCES super_lotto_draws(id),
    base_jackpot DECIMAL(15,2) NOT NULL,
    accumulated_amount DECIMAL(15,2) NOT NULL,
    first_prize_winners INTEGER DEFAULT 0,
    second_prize_winners INTEGER DEFAULT 0,
    prize_distribution JSONB, -- 各等奖分配详情
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 2.5 11选5彩票表
```sql
-- 11选5期次表
CREATE TABLE lottery_draws (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    draw_number VARCHAR(50) UNIQUE NOT NULL,
    draw_time TIMESTAMP NOT NULL,
    close_time TIMESTAMP NOT NULL,
    winning_numbers INTEGER[] DEFAULT '{}',
    status VARCHAR(20) DEFAULT 'OPEN',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 11选5投注记录表
CREATE TABLE lottery_bets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id),
    draw_id UUID NOT NULL REFERENCES lottery_draws(id),
    bet_type VARCHAR(50) NOT NULL,
    position INTEGER, -- 定位胆位置
    numbers INTEGER[] NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    multiplier INTEGER DEFAULT 1,
    potential_win DECIMAL(10,2) NOT NULL,
    actual_win DECIMAL(10,2) DEFAULT 0,
    status VARCHAR(20) DEFAULT 'PENDING',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 2.6 返水系统相关表
```sql
-- VIP等级配置表
CREATE TABLE vip_levels (
    level INTEGER PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    required_turnover DECIMAL(15,2) NOT NULL,
    rebate_rate DECIMAL(5,4) NOT NULL, -- 返水比例，如0.0050表示0.5%
    daily_withdraw_limit DECIMAL(15,2) NOT NULL,
    daily_withdraw_times INTEGER NOT NULL,
    privileges JSONB, -- VIP特权详情
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 统一奖励记录表（整合返水和推荐奖励）
CREATE TABLE user_rewards (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id),
    period_date DATE NOT NULL, -- 奖励周期日期
    
    -- 个人返水部分
    personal_turnover DECIMAL(15,2) DEFAULT 0,
    personal_rebate_rate DECIMAL(5,4) DEFAULT 0,
    personal_rebate_amount DECIMAL(10,2) DEFAULT 0,
    
    -- 推荐奖励部分
    referral_turnover DECIMAL(15,2) DEFAULT 0,
    referral_bonus_amount DECIMAL(10,2) DEFAULT 0,
    referral_details JSONB, -- 各级推荐详情
    
    -- 总计
    total_reward_amount DECIMAL(10,2) NOT NULL,
    vip_level INTEGER NOT NULL,
    status VARCHAR(20) DEFAULT 'PENDING', -- PENDING, PAID, CANCELLED
    paid_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, period_date)
);

-- 流水记录表（用于奖励计算）
CREATE TABLE user_turnover_records (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id),
    game_type VARCHAR(50) NOT NULL, -- SCRATCH, LOTTERY, SPORTS, SUPER_LOTTO
    bet_amount DECIMAL(10,2) NOT NULL,
    valid_amount DECIMAL(10,2) NOT NULL, -- 有效投注额
    transaction_id UUID, -- 关联的交易记录
    record_date DATE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 推荐关系树表（优化推荐层级查询）
CREATE TABLE user_referral_tree (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    ancestor_id UUID NOT NULL REFERENCES users(id), -- 上级用户
    descendant_id UUID NOT NULL REFERENCES users(id), -- 下级用户
    level INTEGER NOT NULL, -- 推荐层级 1-7
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(ancestor_id, descendant_id)
);

-- 奖励配置表
CREATE TABLE reward_config (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    config_type VARCHAR(50) NOT NULL, -- VIP_REBATE, REFERRAL_BONUS
    level INTEGER NOT NULL,
    rate DECIMAL(5,4) NOT NULL,
    description TEXT,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 开发时间计划

### 第一阶段：基础架构搭建 (2-3周)
- [ ] 项目初始化和环境配置
- [ ] 数据库设计和创建
- [ ] 基础认证系统
- [ ] 用户注册登录功能
- [ ] 基础UI组件库

### 第二阶段：财务系统开发 (3-4周)
- [ ] 存款系统集成
- [ ] 提款系统开发
- [ ] 银行账户管理
- [ ] 交易记录查询
- [ ] 支付网关集成

### 第三阶段：核心游戏功能 (5-6周)
- [ ] **11选5彩票系统（核心功能）**
- [ ] 走势分析功能（11选5专用）
- [ ] 大乐透彩票系统
- [ ] "666"刮刮乐系统（简化版）
- [ ] 游戏记录系统
- [ ] 开奖结果管理

### 第四阶段：体育博彩集成 (2-3周)
- [ ] 第三方体育平台对接
- [ ] 钱包转账系统
- [ ] 投注记录同步
- [ ] 平台管理界面

### 第五阶段：统一返水奖励系统 (2-3周)
- [ ] Django VIP等级系统
- [ ] 个人返水机制（Django + Celery异步计算）
- [ ] 推荐奖励机制（整合到返水系统）
- [ ] 统一奖励计算和发放（Django异步任务）
- [ ] 推荐关系树管理（Django模型优化）
- [ ] 奖励查询和历史记录（Django REST API）

### 第六阶段：测试和优化 (2-3周)
- [ ] 功能测试
- [ ] 性能优化
- [ ] 安全测试
- [ ] 移动端适配优化
- [ ] 多语言支持

### 第七阶段：部署和上线 (1-2周)
- [ ] 生产环境部署
- [ ] 监控系统配置
- [ ] 备份策略实施
- [ ] 用户培训和文档

## 安全和合规要求

### 1. 数据安全
- 用户密码使用bcrypt加密
- 敏感数据传输使用HTTPS
- 数据库连接加密
- 定期安全审计

### 2. 反洗钱(AML)
- 用户身份验证(KYC)
- 大额交易监控
- 可疑活动报告
- 交易记录保存

### 3. 负责任博彩
- 自我排除功能
- 存款限额设置
- 游戏时间提醒
- 问题博彩帮助

### 4. 合规要求
- 获得当地博彩牌照
- 遵守当地法律法规
- 税务合规
- 定期合规审查

## 运营和维护

### 1. 监控指标
- 系统性能监控
- 用户行为分析
- 财务数据监控
- 安全事件监控

### 2. 客户服务
- 24/7在线客服
- 多语言支持
- 常见问题解答
- 用户反馈处理

### 3. 营销推广
- 新用户注册奖励
- 首存优惠活动
- VIP专属福利
- 推荐好友奖励

这个开发计划为您的非洲彩票博彩产品提供了全面的技术架构和实施路径，确保产品能够满足当地市场需求，同时保持高质量的用户体验和安全性。

## 详细界面设计和用户体验

### 1. 首页设计

#### 1.1 首页布局结构
```typescript
interface HomePageLayout {
  header: {
    logo: string;
    navigation: NavItem[];
    userActions: {
      login: boolean;
      register: boolean;
      balance: number;
      profile: UserProfile;
    };
  };
  hero: {
    mainBanner: {
      title: string;
      subtitle: string;
      ctaButton: string;
      backgroundImage: string;
    };
    jackpotDisplay: {
      amount: number;
      currency: string;
      label: string;
    };
  };
  gameCategories: GameCategory[];
  promotions: Promotion[];
  footer: FooterContent;
}
```

#### 1.2 首页核心元素
- **大乐透奖池显示**: 醒目展示当前奖池金额，实时更新
- **快速游戏入口**: "666"刮刮乐、11选5、体育博彩的快速入口
- **用户状态栏**: 余额、VIP等级、未读消息
- **促销活动轮播**: 当前活动和优惠信息
- **最近中奖公告**: 增加平台活跃度和信任感

### 2. 财务中心界面设计

#### 2.1 存款界面设计
```typescript
interface DepositPageProps {
  selectedMethod: DepositMethod;
  amount: number;
  currency: 'NGN' | 'USDT';
  paymentMethods: PaymentMethod[];
  userBalance: number;
  depositLimits: {
    min: number;
    max: number;
    daily: number;
  };
}

// 存款界面组件结构
const DepositPage = () => {
  return (
    <div className="deposit-container">
      <BalanceCard balance={userBalance} />
      <PaymentMethodTabs methods={paymentMethods} />
      <AmountInput 
        min={depositLimits.min} 
        max={depositLimits.max}
        currency={currency}
      />
      <PaymentInstructions method={selectedMethod} />
      <SubmitButton loading={isProcessing} />
      <SecurityNotice />
    </div>
  );
};
```

#### 2.2 移动端存款优化
- 大按钮设计，便于触摸操作
- 简化的表单流程
- 二维码扫描支持
- 一键复制银行信息
- 实时状态更新

#### 2.3 提款界面设计
```typescript
const WithdrawalPage = () => {
  return (
    <div className="withdrawal-container">
      <AvailableBalanceCard />
      <WithdrawalMethodSelector />
      <BankAccountSelector />
      <AmountInput withFeeCalculation />
      <SecurityVerification />
      <ProcessingTimeNotice />
      <SubmitButton />
    </div>
  );
};
```

### 3. "666"刮刮乐界面设计

#### 3.1 主游戏界面
```typescript
interface ScratchGameProps {
  currentCard: ScratchCard | null;
  userBalance: number;
  autoScratchEnabled: boolean;
  recentWinnings: WinningRecord[];
}

const ScratchGameInterface = () => {
  return (
    <div className="scratch-game-container">
      {/* 顶部信息栏 */}
      <GameHeader 
        balance={userBalance}
        totalWinnings={sessionWinnings}
      />
      
      {/* 刮刮乐卡片区域 */}
      <ScratchCardArea 
        card={currentCard}
        onScratch={handleScratch}
        onRevealAll={handleRevealAll}
      />
      
      {/* 操作控制区 */}
      <GameControls 
        cardPrice={CARD_PRICE}
        autoScratch={autoScratchEnabled}
        onPurchase={handlePurchase}
        onToggleAuto={handleToggleAuto}
      />
      
      {/* 拼图入口 */}
      <PuzzleEntryButton 
        newPiecesCount={newPuzzlePieces}
        onClick={openPuzzleCenter}
      />
      
      {/* 侧边栏 - 最近中奖 */}
      <RecentWinningsSidebar winnings={recentWinnings} />
    </div>
  );
};
```

#### 3.2 刮奖动画效果
```css
/* 刮奖区域样式 */
.scratch-area {
  position: relative;
  width: 80px;
  height: 60px;
  background: linear-gradient(45deg, #silver, #gray);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.scratch-area.revealed {
  background: transparent;
  transform: scale(1.05);
}

.scratch-area .symbol {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 24px;
  font-weight: bold;
  color: #FF6B35;
}

/* 中奖动画 */
@keyframes winAnimation {
  0% { transform: scale(1); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

.winning-area {
  animation: winAnimation 0.6s ease-in-out;
  box-shadow: 0 0 20px #FFD23F;
}
```

#### 3.3 拼图收集中心界面
```typescript
const PuzzleCenter = () => {
  return (
    <div className="puzzle-center">
      <PuzzleSeriesSelector series={availableSeries} />
      <PuzzleGrid 
        series={selectedSeries}
        userPieces={userCollectedPieces}
        progress={collectionProgress}
      />
      <RewardDisplay 
        reward={completionReward}
        canClaim={isCompleted && !rewardClaimed}
      />
      <CollectionHistory completedSeries={completedSeries} />
    </div>
  );
};
```

### 4. 大乐透彩票界面设计

#### 4.1 大乐透投注界面
```typescript
const SuperLottoInterface = () => {
  return (
    <div className="super-lotto-container">
      {/* 顶部奖池展示 */}
      <JackpotDisplay 
        currentJackpot={currentJackpot}
        nextDrawTime={nextDrawTime}
        countdown={countdown}
      />
      
      {/* 号码选择区域 */}
      <NumberSelectionPanel>
        {/* 前区选择 1-35 选5个 */}
        <FrontNumberGrid 
          numbers={Array.from({length: 35}, (_, i) => i + 1)}
          selected={selectedFrontNumbers}
          maxSelect={5}
          onSelect={handleFrontNumberSelect}
        />
        
        {/* 后区选择 1-12 选2个 */}
        <BackNumberGrid 
          numbers={Array.from({length: 12}, (_, i) => i + 1)}
          selected={selectedBackNumbers}
          maxSelect={2}
          onSelect={handleBackNumberSelect}
        />
      </NumberSelectionPanel>
      
      {/* 快捷选择工具 */}
      <QuickSelectTools 
        frontOptions={['机选5', '全大', '全小', '奇偶', '清空']}
        backOptions={['机选2', '大小', '奇偶', '清空']}
        onFrontQuickSelect={handleFrontQuickSelect}
        onBackQuickSelect={handleBackQuickSelect}
      />
      
      {/* 投注方式选择 */}
      <BetTypeSelector 
        types={[
          { key: 'SINGLE', label: '单式投注', description: '选择5+2个号码' },
          { key: 'MULTIPLE', label: '复式投注', description: '选择更多号码增加中奖机会' },
          { key: 'COMPOUND', label: '胆拖投注', description: '设定胆码和拖码' }
        ]}
        selected={betType}
        onChange={setBetType}
      />
      
      {/* 投注倍数和金额 */}
      <BetAmountControls 
        multiplier={multiplier}
        singleBetCost={singleBetCost}
        totalCost={totalBetCost}
        onMultiplierChange={setMultiplier}
      />
      
      {/* 投注确认 */}
      <BetConfirmation 
        selectedNumbers={{
          front: selectedFrontNumbers,
          back: selectedBackNumbers
        }}
        betType={betType}
        multiplier={multiplier}
        totalAmount={totalBetCost}
        onConfirm={handlePlaceBet}
        onClear={clearAllSelections}
      />
    </div>
  );
};
```

#### 4.2 大乐透开奖结果展示
```typescript
const SuperLottoResults = () => {
  return (
    <div className="lotto-results">
      <DrawResultHeader 
        drawNumber={latestDraw.drawNumber}
        drawDate={latestDraw.drawTime}
        jackpotWinners={jackpotWinners}
      />
      
      <WinningNumbersDisplay 
        frontNumbers={latestDraw.frontNumbers}
        backNumbers={latestDraw.backNumbers}
        animated={true}
      />
      
      <PrizeBreakdown 
        prizes={prizeDistribution}
        totalPrizePool={totalPrizePool}
      />
      
      <HistoricalResults 
        recentDraws={recentDraws}
        onViewMore={showMoreResults}
      />
    </div>
  );
};
```

### 5. 11选5彩票界面设计

#### 5.1 投注界面布局
```typescript
const LotteryInterface = () => {
  return (
    <div className="lottery-container">
      {/* 顶部信息 */}
      <LotteryHeader 
        currentDraw={currentDraw}
        countdown={countdown}
        recentResults={recentResults}
      />
      
      {/* 玩法选择 */}
      <GameModeSelector 
        modes={['定位胆', '任选']}
        selected={selectedMode}
        onChange={setSelectedMode}
      />
      
      {/* 号码选择区 */}
      <NumberSelectionArea 
        mode={selectedMode}
        selectedNumbers={selectedNumbers}
        onNumberSelect={handleNumberSelect}
      />
      
      {/* 快捷选择 */}
      <QuickSelectButtons 
        options={['全', '大', '小', '奇', '偶', '清']}
        onQuickSelect={handleQuickSelect}
      />
      
      {/* 投注控制 */}
      <BettingControls 
        multiplier={multiplier}
        betAmount={betAmount}
        onMultiplierChange={setMultiplier}
      />
      
      {/* 投注清单 */}
      <BettingCart 
        bets={currentBets}
        totalAmount={totalBetAmount}
        onClearAll={clearAllBets}
        onSubmit={submitBets}
      />
    </div>
  );
};
```

#### 4.2 走势分析界面
```typescript
const TrendAnalysis = () => {
  return (
    <div className="trend-analysis">
      <TrendFilters 
        periods={[30, 50, 100]}
        selectedPeriod={selectedPeriod}
        onChange={setSelectedPeriod}
      />
      
      <TrendChart 
        data={trendData}
        highlightHot={showHotNumbers}
        highlightCold={showColdNumbers}
      />
      
      <StatisticsPanel 
        hotNumbers={hotNumbers}
        coldNumbers={coldNumbers}
        missingCounts={missingCounts}
      />
      
      <BackToBettingButton onClick={returnToBetting} />
    </div>
  );
};
```

### 5. 统一返水奖励中心界面设计

#### 5.1 奖励中心概览界面
```typescript
const RewardCenter = () => {
  return (
    <div className="reward-center">
      {/* 用户VIP状态卡片 */}
      <VIPStatusCard 
        currentLevel={vipStatus.currentLevel}
        progress={vipStatus.progressPercentage}
        nextLevelRequirement={vipStatus.nextLevelTurnover}
        rebateRate={vipStatus.rebateRate}
      />
      
      {/* 本期奖励概览 */}
      <CurrentPeriodRewards 
        personalRebate={currentRewards.personalRebateAmount}
        referralBonus={currentRewards.referralBonusAmount}
        totalReward={currentRewards.totalReward}
        status={currentRewards.status}
      />
      
      {/* 推荐团队概览 */}
      <ReferralTeamOverview 
        referralCode={vipStatus.referralCode}
        directReferrals={vipStatus.directReferrals}
        totalTeamSize={vipStatus.totalTeamSize}
        totalEarned={vipStatus.totalReferralEarned}
      />
      
      {/* 奖励历史记录 */}
      <RewardHistory 
        recentRewards={recentRewards}
        onViewMore={showMoreHistory}
      />
    </div>
  );
};
```

#### 5.2 VIP等级展示界面
```typescript
const VIPLevelsDisplay = () => {
  return (
    <div className="vip-levels-display">
      <VIPLevelTabs levels={vipLevels} current={currentLevel} />
      
      {/* 统一奖励比例表格 */}
      <UnifiedRewardTable 
        levels={vipLevels}
        currentLevel={currentLevel}
        columns={[
          { key: 'level', label: 'VIP等级' },
          { key: 'rebateRate', label: '个人返水' },
          { key: 'referralRate', label: '推荐奖励' },
          { key: 'withdrawLimit', label: '提款限额' },
          { key: 'privileges', label: '专属特权' }
        ]}
      />
      
      {/* 升级进度 */}
      <VIPUpgradeProgress 
        current={currentTurnover}
        required={nextLevelTurnover}
        percentage={upgradeProgress}
      />
      
      {/* 奖励说明 */}
      <RewardExplanation 
        personalRebateRules={personalRebateRules}
        referralBonusRules={referralBonusRules}
      />
    </div>
  );
};
```

#### 5.3 推荐团队管理界面
```typescript
const ReferralTeamManagement = () => {
  return (
    <div className="referral-team">
      {/* 推荐码分享 */}
      <ReferralCodeShare 
        referralCode={userReferralCode}
        shareUrl={referralShareUrl}
        qrCode={referralQRCode}
      />
      
      {/* 团队层级展示 */}
      <TeamLevelDisplay 
        referralTree={referralTree}
        maxLevel={7}
        onExpandLevel={expandTeamLevel}
      />
      
      {/* 团队贡献统计 */}
      <TeamContributionStats 
        levelStats={teamLevelStats}
        totalContribution={totalTeamContribution}
        monthlyGrowth={monthlyTeamGrowth}
      />
      
      {/* 推荐奖励明细 */}
      <ReferralBonusDetails 
        bonusBreakdown={referralBonusBreakdown}
        period={selectedPeriod}
        onPeriodChange={setSelectedPeriod}
      />
    </div>
  );
};
```

### 6. 个人中心界面设计

#### 6.1 账户中心概览
```typescript
const AccountCenter = () => {
  return (
    <div className="account-center">
      <UserProfileCard 
        user={currentUser}
        avatar={userAvatar}
      />
      
      <AccountStatusGrid 
        items={[
          { label: '基本资料', status: profileStatus, link: '/profile' },
          { label: '账户安全', status: securityLevel, link: '/security' },
          { label: '银行卡', status: bankCardStatus, link: '/bank-cards' },
          { label: '手机绑定', status: phoneStatus, link: '/phone-binding' }
        ]}
      />
      
      <VIPStatusCard 
        currentLevel={vipLevel}
        progress={vipProgress}
        nextLevelRequirement={nextLevelTurnover}
        privileges={vipPrivileges}
      />
      
      <QuickActions 
        actions={[
          { label: '修改密码', icon: 'lock', link: '/change-password' },
          { label: '实时返水', icon: 'gift', link: '/rebate' },
          { label: '推荐好友', icon: 'users', link: '/referral' }
        ]}
      />
    </div>
  );
};
```

#### 5.2 VIP特权展示
```typescript
const VIPPrivilegesDisplay = () => {
  return (
    <div className="vip-privileges">
      <VIPLevelTabs levels={vipLevels} current={currentLevel} />
      
      <PrivilegeComparison 
        levels={vipLevels}
        currentLevel={currentLevel}
        privileges={[
          '日提款次数',
          '每日提款额度',
          '返水比例',
          '专属客服',
          '生日礼金'
        ]}
      />
      
      <UpgradeProgress 
        current={currentTurnover}
        required={nextLevelTurnover}
        percentage={upgradeProgress}
      />
    </div>
  );
};
```

### 6. 移动端优化设计

#### 6.1 移动端导航设计
```typescript
const MobileNavigation = () => {
  return (
    <div className="mobile-nav">
      {/* 顶部导航栏 */}
      <TopBar 
        logo={logo}
        balance={userBalance}
        notifications={unreadCount}
        menu={toggleMenu}
      />
      
      {/* 底部标签栏 */}
      <BottomTabBar 
        tabs={[
          { label: '首页', icon: 'home', path: '/' },
          { label: '刮刮乐', icon: 'ticket', path: '/scratch' },
          { label: '11选5', icon: 'grid', path: '/lottery' },
          { label: '体育', icon: 'sports', path: '/sports' },
          { label: '我的', icon: 'user', path: '/profile' }
        ]}
        active={currentTab}
      />
      
      {/* 侧边抽屉菜单 */}
      <DrawerMenu 
        isOpen={menuOpen}
        onClose={closeMenu}
        items={menuItems}
      />
    </div>
  );
};
```

#### 6.2 移动端手势支持
```typescript
// 刮刮乐手势支持
const useScratchGesture = (cardRef: RefObject<HTMLElement>) => {
  useEffect(() => {
    const element = cardRef.current;
    if (!element) return;
    
    const hammer = new Hammer(element);
    
    // 支持触摸刮奖
    hammer.on('pan', (e) => {
      const rect = element.getBoundingClientRect();
      const x = e.center.x - rect.left;
      const y = e.center.y - rect.top;
      
      // 刮开对应区域
      scratchArea(x, y);
    });
    
    return () => hammer.destroy();
  }, []);
};
```

### 7. 性能优化策略

#### 7.1 前端性能优化
```typescript
// 懒加载组件
const ScratchGame = lazy(() => import('./components/ScratchGame'));
const LotteryGame = lazy(() => import('./components/LotteryGame'));

// 图片优化
const OptimizedImage = ({ src, alt, ...props }) => {
  return (
    <img 
      src={src}
      alt={alt}
      loading="lazy"
      decoding="async"
      {...props}
    />
  );
};

// 虚拟滚动（用于长列表）
const VirtualizedList = ({ items, renderItem }) => {
  return (
    <FixedSizeList
      height={400}
      itemCount={items.length}
      itemSize={60}
      itemData={items}
    >
      {renderItem}
    </FixedSizeList>
  );
};
```

#### 7.2 缓存策略
```typescript
// API响应缓存
const useApiCache = (key: string, fetcher: () => Promise<any>) => {
  return useSWR(key, fetcher, {
    revalidateOnFocus: false,
    revalidateOnReconnect: true,
    dedupingInterval: 60000, // 1分钟内去重
  });
};

// 本地存储缓存
const cacheManager = {
  set: (key: string, data: any, ttl: number = 3600) => {
    const item = {
      data,
      timestamp: Date.now(),
      ttl: ttl * 1000
    };
    localStorage.setItem(key, JSON.stringify(item));
  },
  
  get: (key: string) => {
    const item = localStorage.getItem(key);
    if (!item) return null;
    
    const parsed = JSON.parse(item);
    if (Date.now() - parsed.timestamp > parsed.ttl) {
      localStorage.removeItem(key);
      return null;
    }
    
    return parsed.data;
  }
};
```

### 8. 国际化和本地化

#### 8.1 多语言支持
```typescript
// 语言配置
const languages = {
  en: {
    common: {
      login: 'Login',
      register: 'Register',
      deposit: 'Deposit',
      withdraw: 'Withdraw',
      balance: 'Balance'
    },
    scratch: {
      title: '666 Scratch Card',
      purchase: 'Purchase Card',
      autoScratch: 'Auto Scratch',
      winnings: 'Winnings'
    }
  },
  fr: {
    common: {
      login: 'Connexion',
      register: 'S\'inscrire',
      deposit: 'Dépôt',
      withdraw: 'Retrait',
      balance: 'Solde'
    },
    scratch: {
      title: 'Carte à Gratter 666',
      purchase: 'Acheter Carte',
      autoScratch: 'Grattage Auto',
      winnings: 'Gains'
    }
  }
};

// 使用示例
const { t } = useTranslation();
<Button>{t('common.login')}</Button>
```

#### 8.2 本地化适配
```typescript
// 货币格式化
const formatCurrency = (amount: number, currency: string = 'NGN') => {
  return new Intl.NumberFormat('en-NG', {
    style: 'currency',
    currency: currency,
    minimumFractionDigits: 2
  }).format(amount);
};

// 日期时间格式化
const formatDateTime = (date: Date, locale: string = 'en-NG') => {
  return new Intl.DateTimeFormat(locale, {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  }).format(date);
};

// 电话号码格式化
const formatPhoneNumber = (phone: string, country: string = 'NG') => {
  const phoneUtil = PhoneNumberUtil.getInstance();
  const number = phoneUtil.parseAndKeepRawInput(phone, country);
  return phoneUtil.format(number, PhoneNumberFormat.INTERNATIONAL);
};
```

### 9. 测试策略

#### 9.1 单元测试
```typescript
// 组件测试示例
describe('ScratchCard Component', () => {
  test('should render card with correct price', () => {
    render(<ScratchCard price={100} />);
    expect(screen.getByText('₦100')).toBeInTheDocument();
  });
  
  test('should handle scratch action', async () => {
    const onScratch = jest.fn();
    render(<ScratchCard onScratch={onScratch} />);
    
    const scratchArea = screen.getByTestId('scratch-area');
    fireEvent.click(scratchArea);
    
    expect(onScratch).toHaveBeenCalled();
  });
});

// API测试示例
describe('Deposit API', () => {
  test('should create deposit request', async () => {
    const mockResponse = { transactionId: '123', status: 'PENDING' };
    jest.spyOn(api, 'post').mockResolvedValue(mockResponse);
    
    const result = await depositService.createDeposit({
      method: 'bank_transfer',
      amount: 1000,
      currency: 'NGN'
    });
    
    expect(result.transactionId).toBe('123');
  });
});
```

#### 9.2 集成测试
```typescript
// E2E测试示例
describe('User Journey', () => {
  test('complete scratch card purchase flow', async () => {
    // 登录
    await page.goto('/login');
    await page.fill('[data-testid=username]', 'testuser');
    await page.fill('[data-testid=password]', 'password');
    await page.click('[data-testid=login-button]');
    
    // 进入刮刮乐
    await page.click('[data-testid=scratch-game-link]');
    
    // 购买卡片
    await page.click('[data-testid=purchase-button]');
    await expect(page.locator('[data-testid=scratch-card]')).toBeVisible();
    
    // 刮开卡片
    await page.click('[data-testid=reveal-all-button]');
    await expect(page.locator('[data-testid=winnings-display]')).toBeVisible();
  });
});
```

这个详细的开发计划涵盖了从技术架构到用户界面设计的各个方面，确保您的非洲彩票博彩产品能够提供优秀的用户体验，同时满足当地市场的特殊需求。整个计划注重实用性和可操作性，为开发团队提供了清晰的实施路径。